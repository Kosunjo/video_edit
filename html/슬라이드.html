<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>슬라이드형 CBT</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 2rem;
    }
    .question {
      margin-bottom: 1.5rem;
    }
    .choice {
      margin-left: 1rem;
    }
    .button-bar {
      margin-top: 1rem;
      display: flex;
      justify-content: space-between;
    }
    .button-bar button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
    #result {
      margin-top: 2rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>🧠 슬라이드형 CBT</h1>

  <div id="quiz"></div>

  <div class="button-bar">
    <button onclick="prevQuestion()" id="prevBtn">◀ 이전 문제</button>
    <button onclick="grade()" id="gradeBtn" style="display: none;">✅ 채점하기</button>
  </div>

  <div id="result"></div>

  <script>
    const originalQuestions = [
      {
        question: "대한민국의 수도는?",
        choices: ["부산", "서울", "인천", "대구"],
        answer: "서울"
      },
      {
        question: "3 + 5는?",
        choices: ["6", "7", "8", "9"],
        answer: "8"
      },
      {
        question: "HTML의 약자는?",
        choices: ["HyperText Markup Language", "HighText Machine Language", "Hyperlink Logic", "None"],
        answer: "HyperText Markup Language"
      }
    ];

    let questions = [];
    let current = 0;
    let userAnswers = [];

    function shuffleArray(arr) {
      return arr.map(v => [Math.random(), v])
                .sort((a, b) => a[0] - b[0])
                .map(v => v[1]);
    }

    function startQuiz() {
      questions = shuffleArray(originalQuestions);
      current = 0;
      userAnswers = new Array(questions.length).fill(null);
      document.getElementById("result").innerHTML = "";
      showQuestion();
    }

    function showQuestion() {
      const q = questions[current];
      const quizDiv = document.getElementById("quiz");

      quizDiv.innerHTML = `
        <div class="question">
          <strong>${current + 1}. ${q.question}</strong><br>
          ${q.choices.map(choice => `
            <label>
              <input type="radio" name="q" value="${choice}"
              ${userAnswers[current] === choice ? "checked" : ""}
              onclick="selectAnswer('${choice}')"> ${choice}
            </label><br>`).join("")}
        </div>
      `;

      // 이전 버튼 상태 설정
      document.getElementById("prevBtn").disabled = current === 0;

      // 마지막 문제이면 채점 버튼 보이기, 아니면 숨기기
      const gradeBtn = document.getElementById("gradeBtn");
      gradeBtn.style.display = (current === questions.length - 1) ? "inline-block" : "none";
    }

    function selectAnswer(choice) {
      userAnswers[current] = choice;

      // 마지막 문제면 다음으로 안 넘어감, 채점 버튼만 표시
      if (current < questions.length - 1) {
        current++;
        showQuestion();
      }
    }

    function prevQuestion() {
      if (current > 0) {
        current--;
        showQuestion();
      }
    }

    function grade() {
      let score = 0;
      let wrongs = [];

      questions.forEach((q, i) => {
        if (userAnswers[i] === q.answer) {
          score++;
        } else {
          wrongs.push(`${i + 1}. ${q.question} → 정답: ${q.answer}`);
        }
      });

      const result = document.getElementById("result");
      result.innerHTML = `
        ✅ 채점 결과: ${score} / ${questions.length}점<br>
        ${wrongs.length > 0 ? `
          <br>❌ 틀린 문제:<br><ul>
            ${wrongs.map(w => `<li>${w}</li>`).join("")}
          </ul>` : `<br>🎉 모든 문제를 맞췄어요!`}
        <br><br><button onclick="startQuiz()">🔄 다시 풀기</button>
      `;
      document.getElementById("quiz").innerHTML = "";
      document.getElementById("gradeBtn").style.display = "none";
      document.getElementById("prevBtn").disabled = true;
    }

    window.onload = startQuiz;
  </script>
</body>
</html>
