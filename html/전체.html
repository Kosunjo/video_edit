<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>CBT 문제 풀기</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 2rem;
    }
    .question {
      margin-bottom: 2rem;
    }
    .choice {
      margin-left: 1rem;
    }
    .button-bar {
      margin: 1.5rem 0;
      display: flex;
      gap: 1rem;
    }
    .button-bar button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
    #result {
      margin-top: 1.5rem;
      font-weight: bold;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <h1>📝 랜덤 CBT (전체 문제 보기)</h1>

  <!-- 상단 버튼 -->
  <div class="button-bar">
    <button onclick="shuffleAndRender()">문제 섞기</button>
    <button onclick="grade()">채점하기</button>
  </div>

  <!-- 문제 표시 영역 -->
  <div id="quiz"></div>

  <!-- 하단 버튼 -->
  <div class="button-bar">
    <button onclick="shuffleAndRender()">문제 섞기</button>
    <button onclick="grade()">채점하기</button>
  </div>

  <!-- 채점 결과 -->
  <div id="result"></div>

  <script>
    const originalQuestions = [
      {
        question: "다음 중 대한민국의 수도는?",
        choices: ["부산", "서울", "대구", "인천"],
        answer: "서울"
      },
      {
        question: "3 + 4 = ?",
        choices: ["5", "6", "7", "8"],
        answer: "7"
      },
      {
        question: "HTML의 약자는?",
        choices: ["HyperText Markup Language", "Hyperlink Machine Logic", "HighText Machine Language", "None"],
        answer: "HyperText Markup Language"
      }
    ];

    let questions = [];

    function shuffleArray(arr) {
      return arr.map(v => [Math.random(), v])
                .sort((a, b) => a[0] - b[0])
                .map(v => v[1]);
    }

    function shuffleAndRender() {
      questions = shuffleArray(originalQuestions);
      const quizDiv = document.getElementById("quiz");
      quizDiv.innerHTML = "";

      questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `<strong>${i + 1}. ${q.question}</strong><br>` +
          q.choices.map(choice => `
            <label>
              <input type="radio" name="q${i}" value="${choice}"> ${choice}
            </label><br>`).join("");
        quizDiv.appendChild(div);
      });

      document.getElementById("result").innerText = "";
    }

    function grade() {
      let score = 0;
      let wrongs = [];
      let unanswered = [];

      questions.forEach((q, i) => {
        const selected = document.querySelector(`input[name=q${i}]:checked`);
        if (!selected) {
          unanswered.push(i + 1); // 문제 번호 (1부터 시작)
        } else if (selected.value === q.answer) {
          score++;
        } else {
          wrongs.push(`${i + 1}. ${q.question} → 정답: ${q.answer}`);
        }
      });

      const result = document.getElementById("result");

      if (unanswered.length > 0) {
        result.innerHTML = `
          ⚠️ 아래 문제에 답을 선택하지 않았습니다:<br>
          ${unanswered.join(', ')}번 문제<br>
          <strong>모든 문제를 선택한 후 다시 채점해주세요.</strong>
        `;
        return;
      }

      result.innerHTML = `✅ 채점 결과: ${score} / ${questions.length}점<br>`;
      if (wrongs.length > 0) {
        result.innerHTML += `<br>❌ 틀린 문제:<br><ul>${wrongs.map(q => `<li>${q}</li>`).join('')}</ul>`;
      }
    }

    window.onload = shuffleAndRender;
  </script>
</body>
</html>
